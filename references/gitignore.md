# Gitignore Strategy for Kano Backlog

## Overview

The Kano Backlog skill follows a **source-of-truth vs derived data** approach to version control. Only canonical data should be committed; all derived/cache data should be gitignored.

## What to Commit (Source of Truth)

✅ **Always commit these:**
- Work items: `items/**/*.md`
- ADRs: `decisions/**/*.md` 
- Configuration: `_config/config.toml`
- Views/dashboards: `views/*.md` (deterministic reports)
- Topic briefs: `topics/*/brief.md` (human-maintained)
- Artifacts: `artifacts/**/*` (when explicitly attached)

## What to Ignore (Derived Data)

❌ **Never commit these:**

### Cache and Indexes
- `**/.cache/` - All cache directories
- `**/_index/` - Search indexes (SQLite, FAISS, etc.)
- `*.sqlite3` - Vector databases
- `*.faiss` - FAISS indexes
- `*.pkl` - Pickled data structures

### Temporary and Logs
- `_logs/` - Application logs
- `_tmp_tests/` - Test artifacts
- `_trash/` - Deleted items (conflict resolution)

### Sandbox and Workspaces
- `_kano/backlog_sandbox/` - Isolated experimentation
- `.cache/worksets/` - Per-item working directories

### Generated Content
- `topics/**/materials/` - Raw collected materials (cache)
- `views/_analysis/` - LLM-generated analysis
- `effective_config.toml` - Runtime config snapshots
- `topics/*/brief.generated.md` - Tool-generated briefs

## Template Usage

The `references/gitignore-template.txt` file contains the standard exclusion rules. During `admin init`, these rules should be:

1. **Appended** to existing `.gitignore` files
2. **Created** as new `.gitignore` if none exists
3. **Merged intelligently** to avoid duplicates

## Rationale

### Repository Size
- Derived data can grow large (embeddings, indexes)
- Cache files are platform/environment specific
- Regenerable data shouldn't bloat repositories

### Merge Conflicts
- Generated files often cause unnecessary conflicts
- Cache timestamps create spurious diffs
- Focus reviews on meaningful content changes

### Reproducibility
- Source code should be sufficient to recreate all derived data
- Clear separation between human decisions and machine output
- Deterministic regeneration from canonical sources

## Implementation Notes

### Merge Strategy
When updating `.gitignore`:
1. Read existing file content
2. Check for existing Kano Backlog section
3. If found, replace section; if not, append
4. Preserve existing rules and comments
5. Use clear section markers for future updates

### Section Markers
```gitignore
# Kano Backlog - Derived/Cache Data (never ignore canonical data)
# Generated by kano-backlog admin init
[rules here]
# End Kano Backlog section
```

### Validation
After updating `.gitignore`:
- Verify no canonical files are accidentally ignored
- Test that cache directories are properly excluded
- Ensure existing project rules remain intact

## Related Commands

```bash
# Initialize with gitignore update
kano-backlog admin init --product myproject --agent myagent

# Regenerate derived data (should work after clone)
kano-backlog embedding build --product myproject --force
kano-backlog view refresh --product myproject --agent myagent

# Validate gitignore effectiveness
git status  # Should not show cache/derived files
```

## See Also

- `references/templates.md` - Item templates
- `references/workflow.md` - Development workflow
- `SKILL.md` - Complete skill documentation